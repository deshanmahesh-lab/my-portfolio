<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="tab-title">Deshan Idamegedara - Full-Stack Developer</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Roboto+Mono:wght@400&display=swap');
        
        :root {
            --glow-color-1: #0ea5e9;
            --glow-color-2: #6366f1;
            --glow-color-3: #a855f7;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #d1d5db;
            overflow-x: hidden;
        }

        /* Aurora Background - */
        .aurora-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: -1; overflow: hidden;
        }
        .aurora-background::before, .aurora-background::after {
            content: ''; position: absolute; filter: blur(100px); opacity: 0.15;
        }
        .aurora-background::before {
            background: radial-gradient(circle, var(--glow-color-1), transparent 60%);
            width: 500px; height: 500px; border-radius: 50%;
            top: -10%; left: -10%; animation: move-aurora-1 25s infinite alternate ease-in-out;
        }
        .aurora-background::after {
            background: radial-gradient(circle, var(--glow-color-3), transparent 60%);
            width: 600px; height: 600px; border-radius: 50%;
            bottom: -15%; right: -15%; animation: move-aurora-2 30s infinite alternate ease-in-out;
        }
        @keyframes move-aurora-1 { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(80vw, 90vh) scale(1.5); } }
        @keyframes move-aurora-2 { 0% { transform: translate(0, 0) scale(1.2); } 100% { transform: translate(-90vw, -70vh) scale(0.8); } }

        .glass-effect {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            -webkit-backdrop-filter: blur(12px);
        }

        .github-bar-container { display: flex; height: 12px; width: 100%; border-radius: 20px; overflow: hidden; background: rgba(30, 41, 59, 0.5); margin-bottom: 24px; }
        .github-bar-segment { height: 100%; transition: width 1s ease-in-out; }

        .project-card { 
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
        }
        .project-card:hover { 
            transform: translateY(-5px); 
            border-color: rgba(56, 189, 248, 0.5); 
            box-shadow: 0 0 25px rgba(56, 189, 248, 0.2); 
        }
        
        .nav-link.active { color: #38bdf8; font-weight: 600; }
    </style>
</head>
<body>
    <div class="aurora-background"></div>

    <header class="fixed top-0 left-0 right-0 z-50 glass-effect">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#home" id="nav-logo" class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-indigo-400 italic">...</a>
            <nav class="hidden lg:flex items-center space-x-8 text-slate-300 font-medium">
                <a href="#home" class="nav-link">Home</a>
                <a href="#skills" class="nav-link">Skills</a>
                <a href="#projects" class="nav-link">Projects</a>
                <a href="#education" class="nav-link">Education</a>
                <a href="#contact" class="nav-link">Contact</a>
                <a href="Deshan_Mahesh_CV.pdf" download="Deshan_Mahesh_CV.pdf" class="ml-4 bg-sky-500 text-white font-black text-[10px] px-5 py-2.5 rounded-full hover:bg-sky-600 transition shadow-lg uppercase tracking-widest italic">Get Resume</a>
            </nav>
        </div>
    </header>

    <main class="w-full pt-16">
        <div class="container mx-auto px-6 md:px-12">
            
            <section id="home" class="min-h-screen flex flex-col justify-center text-center">
                <div class="max-w-4xl mx-auto">
                    <img src="IMG_0608-removebg-preview.png" alt="Profile" class="w-48 h-48 rounded-full mx-auto mb-8 border-4 border-slate-700 shadow-lg">
                    <h1 id="h-name" class="text-5xl md:text-7xl font-bold tracking-tight text-white mb-4">...</h1>
                    <h2 id="h-headline" class="text-2xl md:text-3xl font-medium bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-indigo-400 mb-8">...</h2>
                    <p id="h-bio" class="text-lg text-slate-400 max-w-3xl mx-auto leading-relaxed mb-8">...</p>
                    <div id="contact-bar" class="flex flex-wrap justify-center items-center gap-x-6 gap-y-2 text-slate-400 font-mono text-sm mb-8"></div>
                    <div id="social-bar" class="flex justify-center gap-8 text-3xl"></div>
                </div>
            </section>

            <section id="skills" class="py-20">
                <h2 class="text-4xl font-bold text-center mb-12 bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-indigo-400 italic">Technical Ecosystem</h2>
                <div class="max-w-4xl mx-auto glass-effect p-8 rounded-3xl">
                    <div id="github-stats-container" class="grid md:grid-cols-2 gap-6 mb-10"></div>
                    <p class="text-slate-500 text-xs uppercase font-bold mb-4 tracking-widest text-center">Language Distribution Across Repositories</p>
                    <div id="github-bar" class="github-bar-container"></div>
                    <div id="skills-legend" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
                </div>
            </section>

            <section id="projects" class="py-20">
                <h2 class="text-4xl font-bold text-center mb-4 bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-indigo-400 italic">Featured Repositories</h2>
                <p class="text-center text-slate-500 mb-12 italic">Fetched directly from GitHub with real-time metadata</p>
                <div id="project-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"></div>
            </section>

            <section id="education" class="py-20">
                <h2 class="text-4xl font-bold text-center mb-12 bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-indigo-400 italic">Education</h2>
                <div id="edu-timeline" class="max-w-3xl mx-auto space-y-12 border-l-2 border-slate-700 pl-10 relative ml-4"></div>
            </section>

            <section id="contact" class="py-20">
                <h2 class="text-4xl font-bold text-center mb-12 bg-clip-text text-transparent bg-gradient-to-r from-sky-400 to-indigo-400 italic">Get In Touch</h2>
                <div class="max-w-xl mx-auto glass-effect rounded-lg p-8">
                    <form action="https://api.web3forms.com/submit" method="POST" class="space-y-6">
                        <input type="hidden" name="access_key" value="9bc28906-ad06-4a10-8674-a3c0790b9369">
                        <input type="text" name="name" placeholder="Name" class="w-full p-3 rounded-md bg-slate-900 border border-slate-800 text-white outline-none focus:border-sky-500" required>
                        <input type="email" name="email" placeholder="Email" class="w-full p-3 rounded-md bg-slate-900 border border-slate-800 text-white outline-none focus:border-sky-500" required>
                        <textarea name="message" rows="4" placeholder="Message" class="w-full p-3 rounded-md bg-slate-900 border border-slate-800 text-white outline-none focus:border-sky-500" required></textarea>
                        <button type="submit" class="w-full bg-sky-600 py-3 rounded-full font-bold shadow-lg hover:bg-sky-500 transition">Send Message</button>
                    </form>
                </div>
            </section>

            <footer class="text-center py-10 border-t border-slate-800 mt-12 text-slate-500 text-sm">
                <p>&copy; 2026 Developed by <span id="f-name" class="text-sky-500 font-semibold">...</span></p>
            </footer>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC9EJeuno63NWQH79z29nf59p1zbko0Wwg",
            authDomain: "deshan-portfolio-aacbb.firebaseapp.com",
            projectId: "deshan-portfolio-aacbb",
            storageBucket: "deshan-portfolio-aacbb.firebasestorage.app",
            messagingSenderId: "55323696037",
            appId: "1:55323696037:web:56896fdd64bc9a28cc664c",
            measurementId: "G-K7H10VL1V4"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const GITHUB_USERNAME = "deshanmahesh-lab"; 

        async function loadGitHubData() {
            try {
                document.getElementById('github-stats-container').innerHTML = `
                    <img class="w-full rounded-xl" src="https://github-readme-stats.vercel.app/api?username=${GITHUB_USERNAME}&show_icons=true&theme=transparent&hide_border=true&title_color=0ea5e9&icon_color=6366f1&text_color=94a3b8&bg_color=02061700" alt="Stats" />
                    <img class="w-full rounded-xl" src="https://github-readme-stats.vercel.app/api/top-langs/?username=${GITHUB_USERNAME}&layout=compact&theme=transparent&hide_border=true&title_color=0ea5e9&text_color=94a3b8&bg_color=02061700" alt="Langs" />
                `;

                const response = await fetch(`https://api.github.com/users/${GITHUB_USERNAME}/repos?sort=updated&per_page=15`);
                const repos = await response.json();
                
                const langData = {}; let total = 0;
                repos.forEach(r => { if(r.language) { langData[r.language] = (langData[r.language] || 0) + 1; total++; } });
                const sorted = Object.keys(langData).sort((a,b) => langData[b] - langData[a]);
                const colors = ["#0ea5e9", "#6366f1", "#a855f7", "#ec4899", "#f59e0b", "#10b981", "#ef4444"];

                document.getElementById('github-bar').innerHTML = sorted.map((l, i) => 
                    `<div class="github-bar-segment" style="width: ${(langData[l]/total*100)}%; background-color: ${colors[i % colors.length]}"></div>`
                ).join('');

                document.getElementById('skills-legend').innerHTML = sorted.slice(0, 8).map((l, i) => `
                    <div class="flex items-center gap-2">
                        <div class="w-2 h-2 rounded-full" style="background-color: ${colors[i % colors.length]}"></div>
                        <span class="text-[10px] font-bold text-slate-300 uppercase">${l}</span>
                        <span class="text-[9px] text-slate-500">${((langData[l]/total)*100).toFixed(0)}%</span>
                    </div>`).join('');

                document.getElementById('project-grid').innerHTML = repos.filter(r => !r.fork).map(repo => `
                    <div class="project-card glass-effect rounded-2xl p-6 flex flex-col justify-between">
                        <div>
                            <div class="flex justify-between items-start mb-3">
                                <span class="text-[10px] font-bold text-sky-500 uppercase">${repo.language || 'Project'}</span>
                                <span class="text-[10px] text-slate-500"><i class="fa-solid fa-star text-yellow-500 mr-1"></i>${repo.stargazers_count}</span>
                            </div>
                            <h3 class="text-lg font-bold text-white mb-2 truncate uppercase italic">${repo.name.replace(/-/g, ' ')}</h3>
                            <p class="text-slate-400 text-xs leading-relaxed mb-6 line-clamp-3">${repo.description || 'Visit GitHub to explore the codebase and technical architecture of this repository.'}</p>
                        </div>
                        <div class="flex items-center justify-between border-t border-slate-800 pt-4 mt-auto">
                            <a href="${repo.html_url}" target="_blank" class="text-slate-400 hover:text-white transition"><i class="fa-brands fa-github text-2xl"></i></a>
                            <div class="flex gap-1">
                                ${repo.topics ? repo.topics.slice(0,2).map(t => `<span class="text-[8px] bg-slate-800 text-slate-400 px-2 py-0.5 rounded uppercase font-black tracking-tighter">${t}</span>`).join('') : ''}
                            </div>
                        </div>
                    </div>`).join('');
            } catch (e) { console.error(e); }
        }

        async function loadFirebase() {
            const hSnap = await getDoc(doc(db, "siteConfig", "hero"));
            if(hSnap.exists()){
                const d = hSnap.data();
                document.getElementById('nav-logo').innerText = d.name;
                document.getElementById('h-name').innerText = d.name;
                document.getElementById('h-headline').innerText = d.headline;
                document.getElementById('h-bio').innerText = d.bio;
                document.getElementById('f-name').innerText = d.name;
                // CV URL from Firebase is no longer used for the button, as it's now local -
                document.getElementById('contact-bar').innerHTML = `
                    <a href="mailto:${d.email}" class="hover:text-sky-400 transition">${d.email}</a>
                    <span class="text-slate-700 mx-2">&bull;</span>
                    <a href="tel:${d.phone}" class="hover:text-sky-400 transition">${d.phone}</a>`;
            }

            const sSnap = await getDocs(query(collection(db, "socials"), orderBy("timestamp", "asc")));
            document.getElementById('social-bar').innerHTML = sSnap.docs.map(s => {
                const u = s.data().url;
                const i = u.includes('github')?'fa-brands fa-github':u.includes('linkedin')?'fa-brands fa-linkedin':'fa-solid fa-link';
                return `<a href="${u}" target="_blank" class="text-slate-500 hover:text-sky-400 transition transform hover:scale-110"><i class="${i}"></i></a>`;
            }).join('');

            const eSnap = await getDocs(query(collection(db, "education"), orderBy("timestamp", "desc")));
            document.getElementById('edu-timeline').innerHTML = eSnap.docs.map(d => `
                <div class="relative pl-4 mb-10">
                    <div class="absolute -left-[49px] top-2 w-5 h-5 bg-sky-500 rounded-full border-4 border-slate-950 shadow-md"></div>
                    <p class="text-xs text-sky-400 font-mono font-bold">${d.data().year}</p>
                    <h3 class="text-xl font-semibold text-white mt-1">${d.data().title}</h3>
                    <p class="text-sm text-slate-400 italic">${d.data().inst}</p>
                </div>`).join('');
        }

        loadGitHubData(); loadFirebase();
    </script>
</body>
</html>